# POST /api/proposal

Generate an architecture proposal and migration strategy.

## Endpoint

```
POST /api/proposal
```

## Request Body

```json
{
  "analysisId": "analysis-550e8400"
}
```

### Parameters

| Parameter | Type | Required | Description |
|-----------|------|----------|-------------|
| analysisId | string | Yes | ID of completed analysis |

## Response

### Success (200)

```json
{
  "id": "arch-1701518400000",
  "analysisId": "analysis-550e8400",
  "currentStack": [
    "jQuery",
    "PHP",
    "MySQL"
  ],
  "proposedStack": [
    "React",
    "TypeScript",
    "Node.js",
    "Express",
    "PostgreSQL"
  ],
  "migrationStrategy": "Incremental migration using the Strangler Fig pattern...",
  "phases": [
    {
      "phase": 1,
      "title": "Setup & Planning",
      "description": "Prepare the new project structure",
      "tasks": [
        "Initialize React + TypeScript project with Vite",
        "Set up ESLint and Prettier",
        "Configure Tailwind CSS",
        "Set up testing framework"
      ],
      "priority": "high"
    },
    {
      "phase": 2,
      "title": "Core Migration",
      "description": "Migrate critical functionality",
      "tasks": [
        "Convert jQuery DOM manipulation to React components",
        "Migrate PHP backend to Node.js + Express",
        "Implement TypeScript types",
        "Add comprehensive unit tests"
      ],
      "priority": "high"
    },
    {
      "phase": 3,
      "title": "Refinement",
      "description": "Polish and optimize",
      "tasks": [
        "Performance optimization",
        "Accessibility improvements",
        "Documentation updates",
        "Final testing and deployment"
      ],
      "priority": "medium"
    }
  ],
  "estimatedEffort": "2-3 months"
}
```

### Error Responses

#### 404 Not Found

```json
{
  "error": "Analysis not found"
}
```

#### 500 Internal Server Error

```json
{
  "error": "Failed to generate proposal"
}
```

## Example Usage

### cURL

```bash
curl -X POST http://localhost:3001/api/proposal \
  -H "Content-Type: application/json" \
  -d '{
    "analysisId": "analysis-550e8400"
  }'
```

### JavaScript (Fetch)

```javascript
const analysisId = 'analysis-550e8400';

const response = await fetch('http://localhost:3001/api/proposal', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({ analysisId })
});

const proposal = await response.json();

console.log('Current Stack:', proposal.currentStack);
console.log('Proposed Stack:', proposal.proposedStack);
console.log('Estimated Effort:', proposal.estimatedEffort);
console.log('Migration Phases:', proposal.phases.length);
```

### Python

```python
import requests

response = requests.post(
    'http://localhost:3001/api/proposal',
    json={'analysisId': 'analysis-550e8400'}
)

proposal = response.json()

print('Current Stack:', proposal['currentStack'])
print('Proposed Stack:', proposal['proposedStack'])
print('Estimated Effort:', proposal['estimatedEffort'])

for phase in proposal['phases']:
    print(f"\nPhase {phase['phase']}: {phase['title']}")
    print(f"Priority: {phase['priority']}")
    for task in phase['tasks']:
        print(f"  - {task}")
```

## Understanding the Proposal

### Current Stack
Technologies detected in the analyzed codebase.

### Proposed Stack
Modern alternatives recommended based on the analysis.

### Migration Strategy
High-level approach for migrating from current to proposed stack. Generated by AI based on the specific codebase.

### Phases
Detailed implementation plan broken down into phases with specific tasks and priorities.

### Estimated Effort
Time estimate based on codebase size, complexity, and technical debt score.

## AI Generation

The migration strategy is generated using:
- **Local deployment**: Ollama with CodeLlama or Llama 3
- **Online deployment**: Hugging Face Inference API

If AI generation fails, a template-based fallback is used.

## Next Steps

After generating a proposal, use the [Scaffold Endpoint](/api/scaffold) to download a modern project structure.
